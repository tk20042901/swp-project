<div layout:decorate="~{layouts/customer-layout}" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <div layout:fragment="content">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-12 col-xl-10">
                    <div class="card auth-card shadow-sm">
                        <div class="card-body p-4 p-md-5">
                            <div class="row g-4 g-lg-5">
                                <!-- Cart Summary -->
                                <div class="col-12 col-lg-7">
                                    <h2 class="h5 mb-3">Giỏ hàng của bạn</h2>
                                    <div class="cart-list-scroll">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item d-flex align-items-center justify-content-between"
                                                th:each="item : ${shoppingCartItems}">
                                                <div class="d-flex align-items-center gap-3">
                                                    <img th:src="${item.product.main_image_url}" alt="Ảnh sản phẩm"
                                                        class="img-thumbnail"
                                                        style="width:64px;height:64px;object-fit:cover">
                                                    <div>
                                                        <div class="fw-semibold cart-item-title"
                                                            th:text="${item.product.name}">
                                                            Tên sản phẩm
                                                        </div>
                                                        <div class="text-muted small cart-item-meta">
                                                            <span>Số lượng: <span
                                                                    th:text="${item.quantity}">1</span></span>
                                                            <br>
                                                            <span>
                                                                Đơn giá: <span
                                                                    th:text="${item.product.price} + 'VND/' + ${item.product.unit.name}">0</span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-end">
                                                    <div class="fw-semibold cart-item-total"
                                                        th:text="${#numbers.formatInteger(item.product.price * item.quantity, 0, 'POINT')} + ' VND'">0 VND
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="d-flex justify-content-end mt-3">
                                        <div class="fs-6"><strong>Tổng:</strong> <strong
                                                th:text="${#numbers.formatInteger(totalAmount, 0, 'POINT')} + ' VND'">0</strong>
                                        </div>
                                    </div>
                                </div>

                                <!-- Delivery + Payment Form -->
                                <div class="col-12 col-lg-5">
                                    <h2 class="h5 mb-3">Thông tin giao hàng</h2>

                                    <div class="alerts-stack mb-3" th:if="${payment_error}">
                                        <div class="alert alert-danger py-2" th:text="${payment_error}"></div>
                                    </div>

                                    <form th:action="@{/customer/order-info}" th:object="${deliveryInfoDto}"
                                        method="post">
                                        <!-- Full name -->
                                        <div class="mb-3">
                                            <label for="fullName" class="form-label">Họ và tên</label>
                                            <input id="fullName" type="text" th:field="*{fullName}" class="form-control"
                                                placeholder="VD: Nguyễn Văn A" required maxlength="255">
                                            <div class="invalid-feedback d-block" th:errors="*{fullName}"></div>
                                        </div>

                                        <!-- Province / Ward -->
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="provinceCityCode" class="form-label">Tỉnh/Thành phố</label>
                                                <select id="provinceCityCode" class="form-select" required
                                                    onchange="this.form.submit()" th:field="*{provinceCityCode}">
                                                    <option value="">Chọn Tỉnh/Thành phố</option>
                                                    <option th:each="province : ${provinceCities}"
                                                        th:value="${province.code}" th:text="${province.name}">
                                                    </option>
                                                </select>
                                                <div class="invalid-feedback d-block" th:errors="*{provinceCityCode}">
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-6">
                                                <label for="communeWardCode" class="form-label">Xã/Phường</label>
                                                <select id="communeWardCode" class="form-select"
                                                    th:field="*{communeWardCode}" required>
                                                    <option value="">Chọn Xã/Phường</option>
                                                    <option th:each="ward : ${wards}" th:value="${ward.code}"
                                                        th:text="${ward.name}">
                                                    </option>
                                                </select>
                                                <div class="invalid-feedback d-block" th:errors="*{communeWardCode}">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Specific address + Phone -->
                                        <div class="row g-3 mt-1">
                                            <div class="col-12 col-md-8">
                                                <label for="specificAddress" class="form-label">Địa chỉ chi tiết</label>
                                                <input id="specificAddress" type="text" th:field="*{specificAddress}"
                                                    class="form-control" placeholder="Số nhà, đường, tổ/thôn/xóm..."
                                                    required maxlength="255">
                                                <div class="invalid-feedback d-block" th:errors="*{specificAddress}">
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-4">
                                                <label for="phone" class="form-label">Số điện thoại</label>
                                                <input id="phone" type="tel" th:field="*{phone}" class="form-control"
                                                    placeholder="VD: 0912345678" required maxlength="20"
                                                    inputmode="tel">
                                                <div class="invalid-feedback d-block" th:errors="*{phone}"></div>
                                            </div>
                                        </div>

                                        <!-- Payment methods -->
                                        <fieldset class="mt-4">
                                            <legend class="h6 mb-2">Phương thức thanh toán</legend>
                                            <div th:each="method : ${paymentMethods}" class="form-check">
                                                <label>
                                                    <input class="form-check-input" type="radio"
                                                        th:name="paymentMethodId" th:value="${method.id}"
                                                        th:checked="${method.id == 'COD'}"
                                                        th:text="${method.description}" required>
                                                </label>
                                            </div>
                                            <div class="text-danger" th:if="${paymentMethodError}"
                                                th:text="${paymentMethodError}">Vui lòng chọn phương thức thanh toán
                                            </div>
                                        </fieldset>
                                        <div class="row g-2 mt-4">
                                            <div class="col-12 col-sm-6">
                                                <a class="btn btn-outline-secondary w-100"
                                                    th:href="@{/customer/shopping-cart}">Hủy</a>
                                            </div>
                                            <div class="col-12 col-sm-6 d-grid">
                                                <button type="submit" name="confirm" class="btn btn-primary">Xác nhận
                                                    mua
                                                    hàng
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>